<!DOCTYPE html>
<html>
	<head>
		<title>Video Encoder Dashboard</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 40px;
			}
			.error {
				color: red;
				background: #fee;
				padding: 10px;
				border: 1px solid red;
				margin: 10px 0;
			}
			.breadcrumb {
				background: #f5f5f5;
				padding: 10px;
				margin: 10px 0;
				border-radius: 4px;
			}
			.breadcrumb-item {
				color: #007cba;
				text-decoration: none;
				margin: 0 5px;
			}
			.breadcrumb-item:hover {
				text-decoration: underline;
			}
			.file-browser {
				border: 1px solid #ddd;
				border-radius: 4px;
				min-height: 400px;
				padding: 15px;
				background: #fafafa;
			}
			.directory-item {
				margin: 8px 0;
				padding: 8px;
				background: #e8f4fd;
				border-radius: 3px;
			}
			.directory-link {
				color: #0066cc;
				text-decoration: none;
				font-weight: bold;
			}
			.directory-link:hover {
				text-decoration: underline;
			}
			.file-item {
				margin: 8px 0;
				padding: 8px;
				background: white;
				border: 1px solid #eee;
				border-radius: 3px;
			}
			.file-item:hover {
				background: #f0f8ff;
			}
			.file-size {
				color: #666;
				font-size: 0.9em;
			}
			.file-date {
				color: #888;
				font-size: 0.8em;
			}
			.empty-directory {
				text-align: center;
				color: #666;
				padding: 40px;
			}
			.loading {
				text-align: center;
				color: #666;
				padding: 20px;
			}
			button {
				background: #007cba;
				color: white;
				padding: 12px 24px;
				border: none;
				cursor: pointer;
				border-radius: 4px;
				font-size: 16px;
				margin: 10px 0;
			}
			button:hover {
				background: #005a87;
			}
			button:disabled {
				background: #ccc;
				cursor: not-allowed;
			}
			.form-container {
				margin: 20px 0;
			}
		</style>
	</head>
	<body>
		<h1>Video Encoder Dashboard</h1>

		<form method="post" action="/encode" class="form-container">
			<h2>Browse and Select Video Files</h2>

			<div class="file-browser" id="fileBrowser">
				<div class="loading">Loading files...</div>
			</div>

			<div style="margin: 15px 0">
				<label
					for="preset"
					style="
						display: block;
						margin-bottom: 5px;
						font-weight: bold;
					"
					>Encoding Preset:</label
				>
				<select
					name="preset"
					id="preset"
					style="padding: 5px; width: 200px"
				>
					<option value="ultrafast">Ultra Fast (x265)</option>
					<option value="superfast">Super Fast (x265)</option>
					<option value="veryfast">Very Fast (x265)</option>
					<option value="fast" selected>
						Fast (x265 - Recommended)
					</option>
					<option value="medium">Medium (x265)</option>
					<option value="slow_hq">Slow HQ (x265 10-bit)</option>
				</select>
				<div style="font-size: 12px; color: #666; margin-top: 3px">
					Using x265 codec with resolution-based bitrates:<br />
					• 1080p: 1.5 MB/s • 720p: 1 MB/s • 480p: 750 KB/s • 360p:
					500 KB/s
				</div>
			</div>

			<button type="submit" id="encodeBtn" disabled>
				Start Encoding Selected File
			</button>
		</form>

		<br />
		<a
			href="/status"
			style="
				background: #28a745;
				color: white;
				padding: 10px 20px;
				text-decoration: none;
				border-radius: 4px;
			"
			>Check Job Status</a
		>

		<script>
			let selectedFilePath = null;

			// Load directory contents
			async function loadDirectory(path = "") {
				const fileBrowser = document.getElementById("fileBrowser");
				fileBrowser.innerHTML = '<div class="loading">Loading...</div>';

				try {
					const response = await fetch(
						`/browse?path=${encodeURIComponent(path)}`
					);
					const html = await response.text();
					fileBrowser.innerHTML = html;

					// Re-attach event listeners for radio buttons
					attachFileSelectionListeners();
				} catch (error) {
					fileBrowser.innerHTML = `<div class="error">Error loading directory: ${error.message}</div>`;
				}
			}

			// Attach event listeners to radio buttons
			function attachFileSelectionListeners() {
				const radioButtons = document.querySelectorAll(
					'input[name="file_path"]'
				);
				radioButtons.forEach((radio) => {
					radio.addEventListener("change", function () {
						selectedFilePath = this.value;
						document.getElementById("encodeBtn").disabled = false;
					});
				});
			}

			// Handle form submission
			document
				.querySelector("form")
				.addEventListener("submit", function (e) {
					if (!selectedFilePath) {
						e.preventDefault();
						alert("Please select a video file to encode.");
						return;
					}

					// Create hidden input with selected file path
					const hiddenInput = document.createElement("input");
					hiddenInput.type = "hidden";
					hiddenInput.name = "file_path";
					hiddenInput.value = selectedFilePath;
					this.appendChild(hiddenInput);
				});

			// Load root directory on page load
			document.addEventListener("DOMContentLoaded", function () {
				loadDirectory("{{ current_path }}");
			});
		</script>
	</body>
</html>
